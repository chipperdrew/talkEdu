{% extends "base.html" %}
{% load dictionary_extras %} {# For dictionary access to variable keys #}

{% block content %}
	{{ block.super }}
	<form method="POST" action="{% url 'post_new' %}?next={{request.path}}">
		{% csrf_token %}
		{{ form.as_p }}
		<button name="post_button" type="submit">Post</button>	
	</form>

	<div>
	{% for post in posts %}
		<a href="{% url 'post_page' post_id=post.id %}"><h4>{{ post.title }}</h4></a>
		<p>
			Posted by <a href="{% url 'user_page' user=post.user_id %}">{{ post.user_id }}</a>
			at {{ post.time_created }} and last modified at {{ post.time_modified }}
			User type={{ post.user_id.get_user_type_display }}.
			{% if post.user_id == request.user %}
				<a href="{% url 'post_edit' id=post.id %}?next={{request.path}}">Edit</a>
				<a href="{% url 'post_delete' id=post.id %}?next={{request.path}}"
				onclick="return confirm('Your post and all related comments will be deleted. Proceed?')">Delete</a>
			{% endif %}
		</p>
		<p> 
			{{ vote_dict|key:post }}
		</p>
			<a href="{% url 'up_vote' id=post.id %}?next={{request.path}}">Up</a>
			<a href="{% url 'down_vote' id=post.id %}?next={{request.path}}">Down</a>
		</p>
	{% endfor %}
	</div>


	{# Source: https://docs.djangoproject.com/en/dev/topics/pagination/ #}
	<div class="pagination">
		<span class="step-links">
		{% if posts.has_previous %}
			<a href="?page={{ posts.previous_page_number }}">Previous</a>
		{% endif %}

		<span class="current">
			Page {{ posts.number }} of {{ posts.paginator.num_pages }}
		</span>

		{% if posts.has_next %}
			<a href="?page={{ posts.next_page_number }}">Next</a>
		{% endif %}
		</span>
	</div> 
{% endblock content %}
